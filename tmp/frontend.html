<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat room</title>
  <style>
    body {
      background-color: rgb(210, 225, 251);
      padding: 30px;
      margin: 0;
    }

    h1 {
      text-align: center;
    }

    .container {
      width: 80%;
      margin: 0 auto;
    }

    ul {
      border: 1px solid rgb(0, 12, 139);
      background-color: rgb(255, 255, 255);
      height: 50vh;
      list-style: none;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column-reverse;
    }

    li {
      font-size: 1.3rem;
      color: #212121;
      padding: 0.5rem;
      border-bottom: 0.5px dashed rgb(0, 12, 139);
    }

    .input-group {
      max-width: 600px;
      display: flex;
      justify-content: space-between;
    }

    .input-group input {
      border: 1px solid rgb(0, 12, 139);
      width: 100%;
      margin-right: 0.5rem;
      padding: 1rem;
      display: block;

    }

    .input-group input::placeholder {
      color: lightslategray;
    }

    .input-group button {
      background-color: rgb(0, 12, 139);
      padding: 0.5rem;
      color: rgb(255, 255, 255);
      text-transform: uppercase;
      font-size: 1rem;
    }

    .inactive {
      display: none;
    }

    #createForm {
      margin-top: 30px;
    }

    .create {
      flex-direction: column;
      justify-content: start;
      align-items: center;
      margin: 0 auto;
    }

    .create input {
      margin-bottom: 0.5rem;
      margin-right: 0;
    }

    .create select {
      margin-bottom: 0.5rem;
      border: 1px solid rgb(0, 12, 139);
      width: 100%;
      padding: 0.5rem;
    }
  </style>
</head>

<body>
  <h1>Chat room</h1>
  <div class="container">
    <ul id="messages"></ul>
    <form id="msgForm" class="inactive">
      <div class="input-group">
        <input id="msg" type="text" autocomplete="false" placeholder="enter message" />
        <button type="submit">send</button>
      </div>
    </form>
    <form id="nickForm">
      <div class="input-group">
        <input id="nick" type="text" autocomplete="false" placeholder="enter your nickname" />
        <button type="submit">join</button>
      </div>
    </form>
    <form id="createForm">
      <div class="input-group create">
        <input id="title" type="text" autocomplete="false" placeholder="enter title room" />
        <input id="descr" type="text" autocomplete="false" placeholder="enter description room" />
        <select name="select" id="selest">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
        <button type="submit">create room</button>
      </div>
    </form>
  </div>
  <script src="/node_modules/socket.io/client-dist/socket.io.js"></script>
  <script>
    let nick;
    let socket;
    const room = 'javascript';

    const initSocket = (room, nick) => {
      socket = io("http://localhost:3001/nodeNameSpace", {
        transports: ["websocket"],
        withCredentials: true,
      });


      socket.on('message', ({ nick, msg }) => {
        const messages = document.getElementById('messages');

        messages.insertAdjacentHTML(
          'afterbegin',
          `<li><span style="color: red; font-weight: bold; font-style: italic">${nick}</span>&nbsp;${msg}</li>`
        );
      });

      socket.on('connect', () => {
        socket.emit('join', { room, nick });
      });
    };

    const nickForm = document.getElementById('nickForm');
    const msgForm = document.getElementById('msgForm');
    const createForm = document.getElementById('createForm');

    nickForm &&
      nickForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const nickField = document.getElementById('nick');

        if (!nickField?.value) return;

        nick = nickField.value;

        initSocket(room, nick);

        msgForm.classList.remove('inactive');
        nickForm.classList.add('inactive');
      });

    msgForm &&
      msgForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const msgField = document.getElementById('msg');

        socket.emit('message', { msg: msgField.value, room, nick });

        msgField.value = '';
      });
  </script>
</body>

</html>